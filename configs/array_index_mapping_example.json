{
  "pipeline_name": "数组索引映射示例管道",
  "description": "展示如何使用数组索引访问功能进行数据映射",
  "classification_id": 1,
  "components": [
    {
      "name": "Uniswap V2 事件监控器",
      "type": "event_monitor",
      "chain_name": "ethereum",
      "contract_address": "0xB4e16d0168e52d35CaCD2c6185b44281Ec28C9Dc",
      "abi_path": "abis/uniswap_v2_pair.json",
      "events_to_monitor": ["Swap", "Sync"]
    },
    {
      "name": "多合约调用器",
      "type": "contract_caller",
      "contract_callers": [
        {
          "event_name": "Swap",
          "chain_name": "ethereum",
          "abi_path": "abis/uniswap_v2_pair.json",
          "contract_address": "0xB4e16d0168e52d35CaCD2c6185b44281Ec28C9Dc",
          "method_name": "getReserves",
          "method_params": []
        },
        {
          "event_name": "Swap",
          "chain_name": "ethereum",
          "abi_path": "abis/uniswap_v2_pair.json",
          "contract_address": "0xB4e16d0168e52d35CaCD2c6185b44281Ec28C9Dc",
          "method_name": "token0",
          "method_params": []
        },
        {
          "event_name": "Swap",
          "chain_name": "ethereum",
          "abi_path": "abis/uniswap_v2_pair.json",
          "contract_address": "0xB4e16d0168e52d35CaCD2c6185b44281Ec28C9Dc",
          "method_name": "token1",
          "method_params": []
        },
        {
          "event_name": "Sync",
          "chain_name": "ethereum",
          "abi_path": "abis/uniswap_v2_pair.json",
          "contract_address": "0xB4e16d0168e52d35CaCD2c6185b44281Ec28C9Dc",
          "method_name": "getReserves",
          "method_params": []
        }
      ]
    },
    {
      "name": "数组索引映射器",
      "type": "dict_mapper",
      "dict_mappers": [
        {
          "event_name": "Swap",
          "mapping_rules": [
            {
              "source_key": "event_name",
              "target_key": "event_type",
              "transformer": "to_string",
              "condition": null,
              "default_value": null
            },
            {
              "source_key": "chain_id",
              "target_key": "network_id",
              "transformer": "to_int",
              "condition": null,
              "default_value": null
            },
            {
              "source_key": "contract_address",
              "target_key": "pair_address",
              "transformer": "format_address",
              "condition": null,
              "default_value": null
            },
            {
              "source_key": "transaction_hash",
              "target_key": "tx_hash",
              "transformer": "to_lowercase",
              "condition": null,
              "default_value": null
            },
            {
              "source_key": "block_number",
              "target_key": "block_number",
              "transformer": "to_int",
              "condition": null,
              "default_value": null
            },
            {
              "source_key": "getReserves[0]",
              "target_key": "reserve0",
              "transformer": "to_string",
              "condition": null,
              "default_value": "0",
              "description": "访问 getReserves 数组的第一个元素 - token0 储备量"
            },
            {
              "source_key": "getReserves[1]",
              "target_key": "reserve1", 
              "transformer": "to_string",
              "condition": null,
              "default_value": "0",
              "description": "访问 getReserves 数组的第二个元素 - token1 储备量"
            },
            {
              "source_key": "getReserves[2]",
              "target_key": "last_update_timestamp",
              "transformer": "to_int",
              "condition": null,
              "default_value": 0,
              "description": "访问 getReserves 数组的第三个元素 - 最后更新时间戳"
            },
            {
              "source_key": "token0",
              "target_key": "token0_address",
              "transformer": "format_address",
              "condition": null,
              "default_value": null
            },
            {
              "source_key": "token1", 
              "target_key": "token1_address",
              "transformer": "format_address",
              "condition": null,
              "default_value": null
            },
            {
              "source_key": "args.sender",
              "target_key": "sender_address",
              "transformer": "format_address",
              "condition": null,
              "default_value": null
            },
            {
              "source_key": "args.to",
              "target_key": "recipient_address",
              "transformer": "format_address",
              "condition": null,
              "default_value": null
            },
            {
              "source_key": "args.amount0In",
              "target_key": "amount0_in",
              "transformer": "to_string",
              "condition": null,
              "default_value": "0"
            },
            {
              "source_key": "args.amount1In",
              "target_key": "amount1_in",
              "transformer": "to_string",
              "condition": null,
              "default_value": "0"
            },
            {
              "source_key": "args.amount0Out",
              "target_key": "amount0_out",
              "transformer": "to_string",
              "condition": null,
              "default_value": "0"
            },
            {
              "source_key": "args.amount1Out",
              "target_key": "amount1_out",
              "transformer": "to_string",
              "condition": null,
              "default_value": "0"
            }
          ]
        },
        {
          "event_name": "Sync",
          "mapping_rules": [
            {
              "source_key": "event_name",
              "target_key": "event_type",
              "transformer": "to_string",
              "condition": null,
              "default_value": null
            },
            {
              "source_key": "chain_id",
              "target_key": "network_id",
              "transformer": "to_int",
              "condition": null,
              "default_value": null
            },
            {
              "source_key": "contract_address",
              "target_key": "pair_address",
              "transformer": "format_address",
              "condition": null,
              "default_value": null
            },
            {
              "source_key": "getReserves[0]",
              "target_key": "new_reserve0",
              "transformer": "to_string",
              "condition": null,
              "default_value": "0",
              "description": "同步后的 token0 储备量"
            },
            {
              "source_key": "getReserves[1]",
              "target_key": "new_reserve1",
              "transformer": "to_string",
              "condition": null,
              "default_value": "0",
              "description": "同步后的 token1 储备量"
            },
            {
              "source_key": "args.reserve0",
              "target_key": "sync_reserve0",
              "transformer": "to_string",
              "condition": null,
              "default_value": "0"
            },
            {
              "source_key": "args.reserve1",
              "target_key": "sync_reserve1",
              "transformer": "to_string",
              "condition": null,
              "default_value": "0"
            }
          ]
        }
      ]
    }
  ]
}
